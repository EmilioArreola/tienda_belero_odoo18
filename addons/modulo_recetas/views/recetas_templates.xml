<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <template id="pagina_recetas_lista" name="Lista de Recetas">
            <t t-call="website.layout">
                <div id="wrap" class="container py-4">
                    <h1 class="text-center mb-4">Nuestra variedad de recetas</h1>

                    <div class="d-flex justify-content-end mb-4">
                        <form action="/recetas" method="get" class="form-inline">
                            <div class="input-group">
                                <input type="text" name="search" class="form-control" placeholder="Buscar" t-att-value="search"/>
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="submit">
                                        <i class="fa fa-search"></i> Buscar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="row">
                        <t t-if="recetas" t-foreach="recetas" t-as="receta">
                            <div class="col-md-3 mb-4">
                                <a t-attf-href="/recetas/{{ receta.id }}" class="text-decoration-none text-dark">
                                    <div class="card h-100 shadow-sm">
                                        <img t-if="receta.image_1920"
                                             t-attf-src="/web/image/receta.receta/{{receta.id}}/image_1920"
                                             class="card-img-top img-fluid"
                                             style="height: 200px; object-fit: cover;"
                                             alt="Imagen de receta"/>
                                        <div class="card-body">
                                            <h5 class="card-title font-weight-bold" t-esc="receta.name"/>
                                            <div t-if="receta.categoria_ids" class="mb-2">
                                                <t t-foreach="receta.categoria_ids" t-as="categoria">
                                                    <span class="badge badge-secondary mr-1" t-esc="categoria.name"/>
                                                </t>
                                            </div>
                                            <p class="card-text">
                                                <t t-esc="receta.descripcion_corta[:150] + ('...' if len(receta.descripcion_corta) > 150 else '')"/>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </t>
                        <t t-if="not recetas">
                            <div class="col-12">
                                <p class="text-center text-muted mt-5">No se encontraron recetas que coincidan con tu búsqueda.</p>
                            </div>
                        </t>
                    </div>

                    <div class="d-flex justify-content-center">
                        <t t-call="website.pager" t-options="{'pager': pager}"/>
                    </div>
                    </div>
            </t>
        </template>

        <template id="pagina_receta_detalle" name="Detalle de Receta">
            <t t-call="website.layout">
                <div id="wrap" class="container py-4">

                    <h1 class="text-center mb-4 fw-bold" t-field="receta.name"/>

                    <div class="row text-center my-4 p-3 bg-light rounded">
                        <div t-if="receta.porciones" class="col-md-4">
                            <h5><i class="fa fa-users mr-2"/> Porciones</h5>
                            <p class="lead mb-0"><t t-esc="receta.porciones"/></p>
                        </div>
                        <div t-if="receta.tiempo_preparacion" class="col-md-4">
                            <h5><i class="fa fa-clock-o mr-2"/> Tiempo</h5>
                            <p class="lead mb-0"><t t-esc="receta.tiempo_preparacion"/> min</p>
                        </div>
                        <div t-if="receta.dificultad" class="col-md-4">
                            <h5><i class="fa fa-signal mr-2"/> Dificultad</h5>
                            <p class="lead mb-0"><span t-field="receta.dificultad"/></p>
                        </div>
                    </div>
                    
                    <div class="row mb-5 align-items-start">
                        <div class="col-md-6">
                            <img t-if="receta.image_1920"
                                t-attf-src="/web/image/receta.receta/{{receta.id}}/image_1920"
                                class="img-fluid rounded shadow-sm w-100"
                                style="max-height: 400px; object-fit: cover;"
                                alt="Imagen de receta"/>
                        </div>
                        <div class="col-md-6">
                            <h3>Ingredientes</h3>
                            <div t-field="receta.ingredientes_cantidades"/>

                           <div t-if="receta.ingrediente_ids" class="mt-4">
                                <h4 class="mb-2">Productos en esta receta</h4>
                                <t t-foreach="receta.ingrediente_ids" t-as="ingrediente">
                                    <a t-if="ingrediente.product_id" 
                                    t-attf-href="{{ ingrediente.product_id.website_url }}" 
                                    class="badge px-3 py-2 mr-1 mb-1 text-decoration-none badge-ingrediente">
                                        <t t-esc="ingrediente.name"/>
                                    </a>
                                    <span t-else="" 
                                        class="badge px-3 py-2 mr-1 mb-1 badge-ingrediente">
                                        <t t-esc="ingrediente.name"/>
                                    </span>
                                </t>
                            </div>

                           <div t-if="receta.categoria_ids" class="mt-4">
                                <h4 class="mb-2">Categorías</h4>
                                <t t-foreach="receta.categoria_ids" t-as="categoria">
                                    <span class="badge px-3 py-2 mr-1 mb-1 badge-categoria" t-esc="categoria.name"/>
                                </t>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3>Modo de preparación</h3>
                        <div t-field="receta.instrucciones"/>
                    </div>

                    <div>
                        <h3>Descripción detallada</h3>
                        <div t-field="receta.descripcion_larga"/>
                    </div>
                </div>
            </t>
        </template>

        <record id="menu_recetas_website" model="website.menu">
            <field name="name">Recetas</field>
            <field name="url">/recetas</field>
            <field name="parent_id" ref="website.main_menu"/>
            <field name="sequence" type="int">30</field>
        </record>

    </data>
</odoo>