<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_saleorder_document_inherit_belero_tax" inherit_id="sale.report_saleorder_document">
        
        <xpath expr="//t[@t-set='address']" position="before">
            <t t-set="global_belero" t-value="res_company.env['ir.config_parameter'].sudo().get_param('belero.tax_included') == 'True'"/>
            <t t-set="belero_tax_inc" t-value="global_belero and doc.belero_tax_mode == 'on'"/>
        </xpath>

        <xpath expr="//th[@name='th_taxes']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>
        <xpath expr="//td[@name='td_taxes']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>
        
        <xpath expr="//th[@name='th_subtotal']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>
        <xpath expr="//td[@name='td_subtotal']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>
        
        <xpath expr="//th[@name='th_priceunit']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>
        <xpath expr="//td[@name='td_priceunit']" position="attributes"><attribute name="t-if">not belero_tax_inc</attribute></xpath>

        <xpath expr="//th[@name='th_priceunit']" position="after">
            <th t-if="belero_tax_inc" name="th_priceunit_belero" class="text-end">Precio Unit.</th>
        </xpath>
        <xpath expr="//td[@name='td_priceunit']" position="after">
            <td t-if="belero_tax_inc" name="td_priceunit_belero" class="text-end">
                <span t-esc="line.price_total / (line.product_uom_qty or 1.0)" 
                      t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
            </td>
        </xpath>

        <xpath expr="//th[@name='th_subtotal']" position="after">
            <th t-if="belero_tax_inc" name="th_subtotal_belero" class="text-end">Importe</th>
        </xpath>
        <xpath expr="//td[@name='td_subtotal']" position="after">
            <td t-if="belero_tax_inc" name="td_subtotal_belero" class="text-end">
                <span t-field="line.price_total"/>
            </td>
        </xpath>

        <xpath expr="//div[@name='so_total_summary']" position="attributes">
            <attribute name="t-if">not belero_tax_inc</attribute>
        </xpath>

        <xpath expr="//div[@name='so_total_summary']" position="after">
            <div t-if="belero_tax_inc" name="so_total_summary_belero" class="row justify-content-end">
                <div class="col-4">
                    <table class="table table-sm table-borderless">
                        <tr class="o_total">
                            <td style="padding: 8px 15px !important;"><strong>Total</strong></td>
                            <td class="text-end" style="padding: 8px 15px !important;">
                                <strong t-field="doc.amount_total"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </xpath>

    </template>
</odoo>