<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record model="ir.module.category" id="category_contact_custom_access">
            <field name="name">Gestión de Contactos (Nivel)</field>
            <field name="description">Controla quién puede editar la agenda de contactos.</field>
            <field name="sequence">1</field> 
        </record>

        <record id="group_contact_readonly" model="res.groups">
            <field name="name">Solo Lectura</field>
            <field name="category_id" ref="category_contact_custom_access"/>
        </record>

        <record id="group_contact_editor" model="res.groups">
            <field name="name">Editor / Responsable</field>
            <field name="category_id" ref="category_contact_custom_access"/>
            <field name="implied_ids" eval="[(4, ref('group_contact_readonly'))]"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record>
        
        <record model="ir.module.category" id="category_apps_custom_access">
            <field name="name">Gestión de Aplicaciones</field>
            <field name="description">Controla quién puede ver el menú de Apps e instalar módulos.</field>
            <field name="sequence">2</field>
        </record>

        <record id="group_apps_manager" model="res.groups">
            <field name="name">Permitir Acceso</field>
            <field name="category_id" ref="category_apps_custom_access"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record> 

        <record model="ir.module.category" id="category_dashboard_custom_access">
            <field name="name">Gestión de Tableros Generales</field>
            <field name="description">Controla quién puede ver el menú de Tableros.</field>
            <field name="sequence">3</field>
        </record>

        <record id="group_dashboard_user" model="res.groups">
            <field name="name">Mostrar Tableros Generales</field>
            <field name="category_id" ref="category_dashboard_custom_access"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record>

        <record model="ir.module.category" id="category_recetas_custom_access">
            <field name="name">Gestión de Recetario</field>
            <field name="description">Controla quién puede ver el módulo de Recetas.</field>
            <field name="sequence">4</field>
        </record>

        <record id="group_recetas_viewer" model="res.groups">
            <field name="name">Mostrar Recetario</field>
            <field name="category_id" ref="category_recetas_custom_access"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record>
        
        <record model="ir.module.category" id="category_ventas_custom">
            <field name="name">Gestión de Ventas (Personalizado)</field>
            <field name="description">Controla visibilidad de cotizaciones.</field>
            <field name="sequence">10</field>
        </record>

        <record id="group_ventas_ver_todas" model="res.groups">
            <field name="name">Ver Todas las Cotizaciones</field>
            <field name="category_id" ref="category_ventas_custom"/>
            </record>

        <record id="rule_ventas_personal" model="ir.rule">
            <field name="name">Ventas: Restricción Base (Solo Mío)</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">['|', ('user_id', '=', user.id), ('user_id', '=', False)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="rule_ventas_ver_todas" model="ir.rule">
            <field name="name">Ventas: Permiso Total (Override)</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('permisos_usuarios.group_ventas_ver_todas'))]"/>
        </record>
        <record id="rule_ventas_global_restriction" model="ir.rule">
            <field name="name">Ventas: Restricción Global por Usuario</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            
            <field name="groups" eval="[(6, 0, [])]"/>
            
            <field name="domain_force">
                [(1, '=', 1)] if (
                    user.has_group('permisos_usuarios.group_ventas_ver_todas') or 
                    user.has_group('base.group_portal') or
                    user.has_group('base.group_public') or
                    user.has_group('base.group_system')
                ) else ['|', ('user_id', '=', user.id), ('user_id', '=', False)]
            </field>
        </record>
    </data>
</odoo>